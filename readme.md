ğŸ“… JLPT Appointments

Application de gestion de rendez-vous pour les examens JLPT avec rÃ©servation de crÃ©neaux, vÃ©rification par email et gestion via Supabase.
ğŸš€ Installation
1ï¸âƒ£ Cloner le dÃ©pÃ´t

git clone https://github.com/yanis-san/jlpt-appointments.git
cd jlpt-appointments

2ï¸âƒ£ Activer bash

bash

3ï¸âƒ£ Installer pipenv (si nÃ©cessaire)

pip install pipenv

4ï¸âƒ£ Installer les dÃ©pendances

pipenv install

5ï¸âƒ£ Activer l'environnement virtuel

pipenv shell

ğŸ—„ï¸ Configuration de la base de donnÃ©es (Supabase)
ğŸ“‹ Tables

-- CrÃ©ation des tables
CREATE TABLE slots (
    id bigint GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    date text NOT NULL,
    time text NOT NULL,
    available boolean DEFAULT true
);

CREATE TABLE appointments (
    id bigint GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    date text NOT NULL,
    time text NOT NULL,
    name text NOT NULL,
    phone text NOT NULL,
    email text NOT NULL,
    jlpt_level text NOT NULL,
    created_at timestamp with time zone DEFAULT timezone('utc'::text, now()) NOT NULL
);

âš¡ Index

-- Optimisation avec des index
CREATE INDEX idx_slots_date_time ON slots(date, time);
CREATE INDEX idx_appointments_email ON appointments(email);

ğŸ”’ SÃ©curitÃ© et Policies

-- Activer la sÃ©curitÃ© au niveau des lignes (RLS)
ALTER TABLE slots ENABLE ROW LEVEL SECURITY;
ALTER TABLE appointments ENABLE ROW LEVEL SECURITY;

-- Policies pour slots
CREATE POLICY "Enable insert for authenticated users only"
ON slots FOR INSERT WITH CHECK (true);

CREATE POLICY "Enable read access for all users"
ON slots FOR SELECT USING (true);

CREATE POLICY "Enable update for authenticated users only"
ON slots FOR UPDATE USING (true) WITH CHECK (true);

-- Policies pour appointments
CREATE POLICY "Enable insert for authenticated users only"
ON appointments FOR INSERT WITH CHECK (true);

CREATE POLICY "Enable read access for all users"
ON appointments FOR SELECT USING (true);

ğŸ“„ Variables d'environnement .env
ğŸ”— Supabase

SUPABASE_URL=votre_url_supabase
SUPABASE_KEY=votre_cle_supabase

âœ‰ï¸ Configuration Email (Gmail recommandÃ©)

MAIL_SERVER=smtp.gmail.com
MAIL_PORT=587
MAIL_USE_TLS=True
MAIL_USERNAME=votre_email@gmail.com
MAIL_PASSWORD=votre_mot_de_passe_app
MAIL_DEFAULT_SENDER=votre_email@gmail.com

ğŸ”‘ Flask

SECRET_KEY=votre_cle_secrete_aleatoire

â–¶ï¸ DÃ©marrage de l'application

pipenv run python app.py

ğŸ§ª Tests
ğŸ”¬ ExÃ©cuter tous les tests

pipenv run pytest

ğŸ“Š Voir la couverture des tests

pipenv run pytest --cov=app tests/

ğŸ¯ ExÃ©cuter un test spÃ©cifique

pipenv run pytest tests/test_app.py::test_save_appointment_form -v

ğŸ§° Structure du projet

jlpt-appointments/
â”œâ”€â”€ app.py                  # Application principale
â”œâ”€â”€ templates/               # Templates HTML
â”‚   â”œâ”€â”€ content.html         # Formulaire principal
â”‚   â”œâ”€â”€ error.html           # Page d'erreur
â”‚   â”œâ”€â”€ index.html           # Template de base
â”‚   â”œâ”€â”€ language_buttons.html# SÃ©lecteur de langue
â”‚   â”œâ”€â”€ slots.html           # CrÃ©neaux horaires
â”‚   â”œâ”€â”€ success.html         # Confirmation
â”‚   â””â”€â”€ verify.html          # VÃ©rification email
â”œâ”€â”€ tests/                    # Tests unitaires
â”‚   â”œâ”€â”€ conftest.py           # Configuration de test
â”‚   â””â”€â”€ test_app.py           # Tests principaux
â””â”€â”€ .env                      # Fichier de configuration

âœ… Couverture des fonctionnalitÃ©s et tests
ğŸ“† Gestion des crÃ©neaux

    test_get_available_slots
        VÃ©rifie que les crÃ©neaux disponibles sont bien retournÃ©s
        Exclut les crÃ©neaux non disponibles

ğŸ“„ Soumission du formulaire

    test_save_appointment_form
        VÃ©rifie la soumission du formulaire
        VÃ©rifie l'affichage de la page de vÃ©rification aprÃ¨s soumission

ğŸ” GÃ©nÃ©ration et vÃ©rification de code

    test_verification_code_generation
        VÃ©rifie que le code gÃ©nÃ©rÃ© est bien de 6 chiffres
    test_verify_code
        VÃ©rifie la validation d'un code correct
    test_invalid_verification_code
        VÃ©rifie que les codes incorrects sont rejetÃ©s avec un message adaptÃ©

âœ‰ï¸ Envoi d'email

    test_email_sending_with_code
        VÃ©rifie que l'email de vÃ©rification est bien envoyÃ©

ğŸ“… DisponibilitÃ©s

    test_unavailable_dates
        VÃ©rifie la rÃ©cupÃ©ration correcte des dates indisponibles

ğŸ› ï¸ Initialisation de la base

    test_initialize_slots
        VÃ©rifie que les crÃ©neaux sont bien crÃ©Ã©s dans Supabase

ğŸ”„ Flux complet

    test_save_appointment_email_flow
        Teste le parcours complet de rÃ©servation
        De la soumission Ã  la rÃ©ception de lâ€™email de vÃ©rification

ğŸ¤ Contribution

Les contributions sont les bienvenues !
Nâ€™hÃ©sitez pas Ã  ouvrir une issue ou proposer une pull request.
ğŸ“¬ Notes

    Pour les emails via Gmail, pensez Ã  crÃ©er un mot de passe dâ€™application (indispensable si la double authentification est activÃ©e).
    Supabase est utilisÃ© comme backend sans serveur pour la gestion des crÃ©neaux et des rendez-vous.
    Flask est utilisÃ© pour le serveur principal et la logique de vÃ©rification.